<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Handling File in Python | Duc Minh Quang Nguyen</title> <meta name="author" content="Duc Minh Quang Nguyen"> <meta name="description" content="# A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nminhquang380.github.io/myblog/2023/python_file_handling/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Duc Minh Quang </span>Nguyen</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Portfolio</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item "> <a class="nav-link" href="/bucket_list/">My Bucket List</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Handling File in Python</h1> <p class="post-meta">August 31, 2023</p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2023   ·   <i class="fa-solid fa-tag fa-sm"></i> machinelearning   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Using Python as my primary language, but sometimes I really struggle with file handling. Usually, when I read articles, books or just some kind of documents, I try to copy their codes to handle files. One of the reasons is that in first, I didn’t think it was important, because it was merely used to download, and open file. But when I tried to make it by myself, it turned out something different and difficult as well. Their codes are really complex in someways. Thus, in this post, I will try to learn how to handle files.</p> <p>This post will cover:</p> <ul> <li>Open &amp; Close</li> <li>Read &amp; Write</li> <li>Copy, Move &amp; Delete</li> <li>Search</li> <li>Move file pointer</li> <li>File Status</li> <li>Play with file path (the most terrifying stuff for me)</li> </ul> <p>This post is inspired of a article in Toward Data Science, here is <a href="https://towardsdatascience.com/knowing-these-you-can-cover-99-of-file-operations-in-python-84725d82c2df" rel="external nofollow noopener" target="_blank">link</a>.</p> <h2 id="open--close">Open &amp; Close</h2> <p>Python has a built-in function open that opens the file and returns a file object. The type of the file object depends on the mode in which the file is opened. It can be a text file object, a raw binary file, and a buffered binary file. Every file object has methods such as read() and write().</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file = open("test_file.txt","w+")
file.read()
file.write("a new line")
</code></pre></div></div> <p>The most common modes are listed in the table. An important rule is that any w related mode will first truncate the file if it exists and then create a new file. Be careful with this mode if you don’t want to overwrite the file and use a append mode if possible.</p> <table> <thead> <tr> <th>mode</th> <th>meaning</th> </tr> </thead> <tbody> <tr> <td>r</td> <td>open for reading (default)</td> </tr> <tr> <td>r+</td> <td>open for both reading and writing (file pointer is at the beginning of the file)</td> </tr> <tr> <td>w</td> <td>open for writing (truncate the file if it exists)</td> </tr> <tr> <td>w+</td> <td>open for both reading and writing (truncate the file if it exists)</td> </tr> <tr> <td>a</td> <td>open for writing (append to the end of the file if exists &amp; file pointer is at the end of the file)</td> </tr> </tbody> </table> <p>The problem in the previous code block is that we only opened the file, but didn’t close it. It’s important to always close the file when working with files. Having an open file object can cause unpredictable behaviors such as resource leak. There are two ways to make sure that a file is closed properly.</p> <ol> <li>Use close() A good practice is to put it in finally, so that we can make sure the file will be closed in any case.</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>try:
    file = open('test_file.txt', 'w+')
    file.write('Hello')
exception Exception as e:
    logging.exception(e)
finally:
    file.close()
</code></pre></div></div> <ol> <li>Use context manager with open(…) as f With open() as f statement implements <strong>enter</strong> and <strong>exit</strong> methods to open and close the file. Besides, it encapsulates try/finally statement in the context manager, which means we will never forget to close the file.</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>with open('test_file', 'w+') as file:
    file.write('a new line')
</code></pre></div></div> <h2 id="read--write">Read &amp; Write</h2> <p>The file object provides 3 methods to read a file which are read(), readline() and readlines().</p> <ul> <li>read(size=-1) returns the entire contents of a file.</li> <li>readline(size=-1) returns an entire line including character \n at the end.</li> <li>readlines(hint=-1) returns all the lines of a file in a list. The optional parameter hint means if the number of characters returned exceeds hint, no more lines will be returned.</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>with open('test.txt', 'r') as reader:
    line = reader.readline()
    while line != "":
        line = reader.readline()
        print(line)
</code></pre></div></div> <p>In terms of writing, there are 2 methods write() and writelines(). <strong>It’s the responsibility of the developer to add \n at the end.</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>with open('test.txt', 'w+') as f:
    f.write('hi\n')
    f.writelines(['this is a line\n', 'this is another line\n'])

#&gt;&gt;&gt; cat test.txt
# hi
# this is a line
# this is another line
</code></pre></div></div> <p>If you write text to a special file type such as JSON or csv, then you should use Python built-in module json or csv on top of file object.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import csv
import json

with open('cities.csv', 'w+') as file:
    writer = csv.DicWriter(file, fieldnames=['city', 'country'])
    writer.writerheader()
    writer.writerow({'city': 'Amsterdam', 'country': 'Netherlands'})
    writer.writerows(
        [
            {'city': 'Hanoi', 'country': 'Vietnam'},
            {'city': 'Melbourne', 'country': 'Australia'}
        ]
    )

with open('cities.json', 'w+') as file:
json.dump({'city': 'Amsterdam', 'country': 'Netherlands'}, file)

</code></pre></div></div> <h2 id="move-pointer-within-the-file">Move pointer within the file</h2> <p>When we open a file, we get a file handler that points to a certain position. In r and w modes, the handler points to the beginning of the file. In a mode, the handler points to the end of the file.</p> <p>As we read from the file, the pointer moves to the place where the next read will start from, unless we tell the pointer to move around. You can do this using 2 methods: tell() and seek().</p> <p>tell() returns the current position of the pointer as number of bytes/characters from the beginning of the file. seek(offset,whence=0) moves the handler to a position offset characters away from whence. whence can be:</p> <p>0: from the beginning of the file 1: from the current position 2: from the end of the file</p> <h2 id="understand-the-file-status">Understand the file status</h2> <p>The file system on the operating system can tell you a number of practical information about a file. For example, what’s the size of the file, when it was created and modified. To get this information in Python, you can use os or pathlib module. Actually there are many common things between os and pathlib. pathlib is a more object-oriented module than os.</p> <p><strong><em>os</em></strong></p> <p>A way to get a complete status is to use os.stat(‘test.txt’).</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(os.stat("text.txt"))
&gt;&gt;&gt; os.stat_result(st_mode=33188, st_ino=8618932538, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=16, st_atime=1597527409, st_mtime=1597527409, st_ctime=1597527409)
</code></pre></div></div> <p>You can get styatistics individually using os.path</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>os.path.getatime()
os.path.getctime()
os.path.getmtime()
os.path.getsize()
</code></pre></div></div> <p><strong><em>Pathlib</em></strong></p> <p>Another way to get the complete status is to use pathlib.Path(“text.txt”).stat(). It returns the same object as os.stat().</p> <h2 id="copy-move-and-delete-a-file">Copy, Move and Delete a file</h2> <p>Python has many built-in modules to handle file movement. Before you trust the first answer returned by Google, you should be aware that different choices of modules can lead to different performances. Some modules will block the thread until the file movement is done, while others might do it asynchronously.</p> <p><strong><em>shutil</em></strong></p> <p>shutil is the most well-known module for moving, copying, and deleting both files and folders. It provides 4 methods to only copy a file. copy(), copy2() and copyfile().</p> <p>copy() v.s. copy2(): copy2() is very much similar to copy(). The difference is that copy2() also copies the metadata of the file such as the most recent access time, the most recent modification time. But according to Python doc, even copy2() cannot copy all the metadata due to the constrain on the operating system.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shutil.copy("1.csv", "copy.csv")
shutil.copy2("1.csv", "copy2.csv")

print(pathlib.Path("1.csv").stat())
print(pathlib.Path("copy.csv").stat())
print(pathlib.Path("copy2.csv").stat())
# 1.csv
# os.stat_result(st_mode=33152, st_ino=8618884732, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=11, st_atime=1597570395, st_mtime=1597259421, st_ctime=1597570360)

# copy.csv
# os.stat_result(st_mode=33152, st_ino=8618983930, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=11, st_atime=1597570387, st_mtime=1597570395, st_ctime=1597570395)

# copy2.csv
# os.stat_result(st_mode=33152, st_ino=8618983989, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=11, st_atime=1597570395, st_mtime=1597259421, st_ctime=1597570395)
</code></pre></div></div> <p>copy() v.s. copyfile(): copy() sets the permission of the new file the same as the original file, but copyfile() doesn’t copy its permission mode. Secondly, the destination of copy() can be a directory. If a file with the same name exists, it will be overwritten, otherwise, a new file will be created. But, the destination of copyfile() must be the target file name.</p> <p><strong><em>os</em></strong></p> <p>os module has a function system() that allows you to execute the command in a subshell. You need to pass the command as an argument to the system(). This has the same effect as the command executed on the operating system. For moving and deleting files, you can also use dedicated functions in os module.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># copy
os.system("cp 1.csv copy.csv")

# rename/move
os.system("mv 1.csv move.csv")
os.rename("1.csv", "move.csv")

# delete
os.system("rm move.csv")
</code></pre></div></div> <h2 id="search-a-file">Search a File</h2> <p>After copying and moving files, you will probably want to search for filenames that match a particular pattern. Python provides a number of built-in functions for you to choose from.</p> <p><strong><em>glob</em></strong></p> <blockquote> <blockquote> <p>The glob module finds all the pathnames matching a specified pattern according to the rules used by the Unix shell. It supports wildcard characters such as * ? [].</p> </blockquote> </blockquote> <p>glob.glob(“*.csv”) searches for all the files that have csv extension in the current directory. glob module makes it possible to search for files in the subdirectories as well.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import glob
glob.glob('*.csv')
# ['1.csv', '2.csv']
glob.glob('**/*.csv', recursive=True)
# ['1.csv', '2.csv', 'source/3.csv']
</code></pre></div></div> <p><strong><em>os</em></strong></p> <p>We can simply list all the files in the directory using os.listdir() and use file.endswith() and file.startswith() to detect the pattern. If you want to traverse the directory, then use os.walk().</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os

for file in os.listdir('.'):
    if file.endswith('.csv'):
        print(file)

for root, dirs, files in os.walk('.'):
    for file in files:
        if file.endswith('.csv'):
            print(file)
</code></pre></div></div> <p><strong><em>pathlib</em></strong></p> <p>pathlib has a similar function to the glob module. It’s possible to search filenames recursively as well. Compared to the previous solution based on os, pathlib has less code and offers a more object-oriented solution.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from pathlib import Path
    
    p = Path('.')
    for name in p.glob('**/*.csv'):
        print(name)
</code></pre></div></div> <h2 id="play-with-file-path">Play with file path</h2> <p><strong><em>relative and absolute path</em></strong></p> <p>Both os and pathlib offer functions to get the relative path and absolute path of a file or a directory.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import pathlib

print(os.path.abspath("1.txt"))
print(os.path.respath("1.txt"))

print(pathlib.Path('1.txt').absolute())
print(pathlib.Path('1.txt'))
</code></pre></div></div> <p><strong><em>Joining Paths</em></strong></p> <p>This is how we can join paths in os and pathlib independent of the environment. pathlib uses a slash to create child paths.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import pathlib

print(os.path.join('/home', 'file.txt'))
print(pathlib.Path('/home') / 'file.txt')
</code></pre></div></div> <p><strong><em>Getting the parent directory</em></strong></p> <p>dirname() is the function to get parent directory in os, while in pathlib, you can just use Path().parent to get the parent folder.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import pathlib

# relative path
print(os.path.dirname("source/2.csv"))
# source
print(pathlib.Path("source/2.csv").parent)
# source

# absolute path
print(pathlib.Path("source/2.csv").resolve().parent)
# /Users/&lt;...&gt;/project/source
print(os.path.dirname(os.path.abspath("source/2.csv")))
# /Users/&lt;...&gt;/project/source
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/myblog/2023/error_exception_python/">Error and Exception in Python</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/myblog/2023/build-ds-project/">Get lost when trying to build a Data Science Project</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/myblog/2023/intro_pytorch/">Introduction to PyTorch</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/myblog/2023/performance-measures/">Performance Metrics in Machine Learning</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/myblog/2023/review-machine-learning/">Basic Concepts of Machine Learning</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Duc Minh Quang Nguyen. # Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. # Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. # Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>